{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Nuestra Colecci√≥n</h2>
        <a href="{{ url_for('libros.crear') }}" style="background: #333; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
            + A√±adir Libro
        </a>
    </div>

    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #ddd;">
        
        <form method="GET" action="{{ url_for('libros.grid') }}" style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
            
            <div style="flex-grow: 1; min-width: 200px;">
                <input type="text" name="search" placeholder="¬øQu√© libro buscas?" 
                       value="{{ request.args.get('search', '') }}"
                       style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" name="disponibles" id="chk_disponibles" value="1" 
                       {% if request.args.get('disponibles') %}checked{% endif %}>
                <label for="chk_disponibles" style="cursor: pointer; margin-bottom: 0;">Solo Disponibles</label>
            </div>

            <button type="submit" style="background: #007bff; color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer;">
                üîç Buscar
            </button>
            
            <a href="{{ url_for('libros.grid') }}" style="text-decoration: none; color: #6c757d; padding: 5px;">
                Limpiar
            </a>
        </form>
    </div>

    <div class="grid-container">
        {% for libro in libros %}
            <div class="card" style="display: flex; flex-direction: column;">
                
                <h1 style="margin-top: 0;">{{ libro.titulo }}</h1>
                <p class="autor">Por {{ libro.autor }}</p>
                
                <div style="margin-bottom: 10px; font-size: 0.85rem; color: #666;">
                    <span style="background: #e0e0e0; padding: 2px 6px; border-radius: 4px;">{{ libro.genero }}</span>
                    <span>({{ libro.anio }})</span>
                </div>

                <p class="resumen" style="flex-grow: 1;">
                    {% if libro.resumen %}
                        {{ libro.resumen[:100] }}...
                    {% else %}
                        Sin resumen disponible.
                    {% endif %}
                </p>

                <div style="margin-top: auto; padding-top: 15px; border-top: 1px solid #eee;">
                    
                    {% if libro.disponible %}
                        <a href="{{ url_for('libros.prestar', id=libro.id) }}" 
                           style="display: block; width: 100%; text-align: center; background: #007bff; color: white; padding: 10px; text-decoration: none; border-radius: 4px; margin-bottom: 10px;">
                           Prestar Libro
                        </a>
                    {% else %}
                        <div style="text-align: center; font-size: 0.9rem; margin-bottom: 5px;">
                            <span style="color: #666;">Prestado a:</span><br>
                            <strong>{{ libro.socio.nombre if libro.socio else 'Desconocido' }}</strong>
                        </div>

                        <a href="{{ url_for('libros.devolver', id=libro.id) }}" 
                           style="display: block; width: 100%; text-align: center; background: #ffc107; color: #333; padding: 10px; text-decoration: none; border-radius: 4px; font-weight: bold; margin-bottom: 10px;">
                           ‚Üª Devolver Libro
                        </a>
                    {% endif %}

                    <div style="display: flex; gap: 10px;">
                        <a href="{{ url_for('libros.editar', id=libro.id) }}" 
                           style="flex: 1; text-align: center; background: #6c757d; color: white; padding: 8px; text-decoration: none; border-radius: 4px; font-size: 0.9rem;">
                           ‚úèÔ∏è Editar
                        </a>

                        {% if libro.disponible %}
                            <a href="{{ url_for('libros.eliminar', id=libro.id) }}" 
                               onclick="return confirm('¬øSeguro que quieres borrar este libro?');"
                               style="flex: 1; text-align: center; background: #dc3545; color: white; padding: 8px; text-decoration: none; border-radius: 4px; font-size: 0.9rem;">
                               üóëÔ∏è Borrar
                            </a>
                        {% else %}
                            <span style="flex: 1;"></span>
                        {% endif %}
                    </div>

                </div>
            </div>
        {% else %}
            <p style="grid-column: 1/-1; text-align: center;">No se encontraron libros con esos criterios.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}